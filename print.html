<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Gorse Document</title>
        
        <meta name="robots" content="noindex" />
        
        


        <!-- Custom HTML head -->
        


        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        
        <link rel="icon" href="favicon.svg">
        
        
        <link rel="shortcut icon" href="favicon.png">
        
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        
        <link rel="stylesheet" href="css/print.css" media="print">
        

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        
        <link rel="stylesheet" href="fonts/fonts.css">
        

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="chapter_1.html"><strong aria-hidden="true">1.</strong> Chapter 1: Introduction</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="ch01-01-principle.html"><strong aria-hidden="true">1.1.</strong> Recommendation Principles</a></li><li class="chapter-item expanded "><a href="ch01-02-architect.html"><strong aria-hidden="true">1.2.</strong> System Architecture</a></li></ol></li><li class="chapter-item expanded "><a href="chapter_2.html"><strong aria-hidden="true">2.</strong> Chapter 2: User Guide</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="ch02-01-config.html"><strong aria-hidden="true">2.1.</strong> Configuration</a></li><li class="chapter-item expanded "><a href="ch02-02-command.html"><strong aria-hidden="true">2.2.</strong> Commands</a></li><li class="chapter-item expanded "><a href="ch02-03-api.html"><strong aria-hidden="true">2.3.</strong> RESTful API</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">Gorse Document</h1>

                    <div class="right-buttons">
                        
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                        
                        

                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="chapter-1-introduction"><a class="header" href="#chapter-1-introduction">Chapter 1: Introduction</a></h1>
<p>Recommender systems are mature technologies, and there are already many recommender system toolkits on the web and various recommenders published in various top conferences. Even though there is a lot of public information about recommender systems, there is a lack of an open source recommender system that works out of the box. Such a phenomenon is actually caused by the nature of the recommender system itself, which involves different technologies including storage, computation, and business. Gorse aims to be a universal open source recommender system that can be easily introduced into online services.</p>
<h2 id="a-hrefch01-01-principlehtmlrecommendation-principlesa"><a class="header" href="#a-hrefch01-01-principlehtmlrecommendation-principlesa"><a href="ch01-01-principle.html">Recommendation Principles</a></a></h2>
<p>The process of recommending items consists of two phases, <strong>matching</strong> and <strong>ranking</strong>. The matching phase finds a collection of candidate items from all items for subsequent ranking. Due to the large number of items, the recommender system is unable to perform the computational workload of ranking all items, so the matching phase uses simple strategies or models to collect the candidate items. At present, the system has implemented three matching strategies, namely &quot;recent popular items&quot;, &quot;latest items&quot; and &quot;collaborative filtering&quot;. The ranking phase ranks the matched items after removing duplicate items and historical items. The ranking model exploits the items and user features to improve recommendation accuracy.</p>
<center><img src="img/dataflow.png" height="180"></center>
<h2 id="a-hrefch01-02-architecthtmlsystem-architecturea"><a class="header" href="#a-hrefch01-02-architecthtmlsystem-architecturea"><a href="ch01-02-architect.html">System Architecture</a></a></h2>
<p>Gorse is a single node training and distributed prediction recommender system. Gorse stores data in MySQL or MongoDB, with intermediate data cached in Redis. The cluster consists of a master node, multiple worker nodes, and server nodes. The master node is responsible for ranking model training, collaborative filtering model training, non-personalized item matching, configuration management, and membership management. The server node is responsible for exposing the RESTful APIs and online real-time recommendations. Worker nodes are responsible for personalized matching for each user - currently only collaborative filtering is supported. In addition, administrator can perform model tuning, data import and export, and system status checking via the CLI.</p>
<center><img src="img/arch.png" height="200"></center>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="recommendation-principles"><a class="header" href="#recommendation-principles">Recommendation Principles</a></h1>
<p>Recommendation consists of two phases: matching and ranking. The number of items in a recommender system is usually very large, and it is not practical to ranking all items. Therefore, the matching phase is needed to filter out candidate items from all items, and then the ranking model utilizes the item and user labels for more accurate ranking.</p>
<center><img src="img/dataflow.png" height="180"></center>
<h2 id="matching-strategies"><a class="header" href="#matching-strategies">Matching Strategies</a></h2>
<p>There are currently three matching strategies in the system: latest items, recently popular items and collaborative filtering. In fact, recall strategies are not limited to these three, but can also be based on the user's interested tags, items similar to the user's favorite items, etc. Feel free to discuss in <a href="https://github.com/zhenghaoz/gorse/issues">issues</a>.</p>
<ul>
<li>
<p><strong>Latest Items:</strong> Add the latest items directly to the ranking phase so that new items are given the opportunity to be exposed.</p>
</li>
<li>
<p><strong>Recent Popular Items:</strong> Users are more likely to like popular items, but we need to set a time limit to avoid recommending &quot;outdated&quot; popular items.</p>
</li>
<li>
<p><strong>Collaborative Filtering:</strong> Use collaborative filtering to filter candidate items from the entire item pool. Since collaborative filtering does not use item labels, it is less computationally intensive and suitable for matching scenarios. Three collaborative filtering models, BPR, ALS and CCD, are implemented in the system.</p>
</li>
</ul>
<table><thead><tr><th>Model</th><th>Paper</th></tr></thead><tbody>
<tr><td>ALS</td><td>Hu, Yifan, Yehuda Koren, and Chris Volinsky. &quot;Collaborative filtering for implicit feedback datasets.&quot; <em>2008 Eighth IEEE International Conference on Data Mining</em>. Ieee, 2008.</td></tr>
<tr><td>BPR</td><td>Rendle, Steffen, et al. &quot;BPR: Bayesian personalized ranking from implicit feedback.&quot; arXiv preprint arXiv:1205.2618 (2012).</td></tr>
<tr><td>CCD</td><td>He, Xiangnan, et al. &quot;Fast matrix factorization for online recommendation with implicit feedback.&quot; Proceedings of the 39th International ACM SIGIR conference on Research and Development in Information Retrieval. 2016.</td></tr>
</tbody></table>
<h2 id="ranking-mechanism"><a class="header" href="#ranking-mechanism">Ranking Mechanism</a></h2>
<p>The ranking model takes into account labels of the items, especially for new items, where the label is the basis for deciding whether to push the new item to the user or not. The ranking model for this system is factorization machines.</p>
<table><thead><tr><th>Model</th><th>Paper</th></tr></thead><tbody>
<tr><td>FM</td><td>Rendle, Steffen. &quot;Factorization machines.&quot; <em>2010 IEEE International Conference on Data Mining</em>. IEEE, 2010.</td></tr>
</tbody></table>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="system-architecture"><a class="header" href="#system-architecture">System Architecture</a></h1>
<p>This chapter will introduce the design of data storage and cache storage, and the division of labor between master nodes, server nodes and worker nodes. RESTful APIs and CLI tools can be found in <a href="ch02-03-api.html">RESTful APIs</a> and <a href="ch02-02-command.html">Commands</a>.</p>
<center><img src="img/arch.png" height="200"></center>
<h2 id="data-storage"><a class="header" href="#data-storage">Data Storage</a></h2>
<p>The data storage consists of three tables (in MongoDB that's three collections): the items table, the users table, and the feedback table.</p>
<ul>
<li><strong>Items</strong></li>
</ul>
<table><thead><tr><th>Field Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>item_id</code></td><td>string</td><td>Item ID</td></tr>
<tr><td><code>time_stamp</code></td><td>time</td><td>Item update date</td></tr>
<tr><td><code>labels</code></td><td>array of strings</td><td>Item labels</td></tr>
</tbody></table>
<ul>
<li><strong>Users</strong></li>
</ul>
<table><thead><tr><th>Field Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>user_id</code></td><td>string</td><td>User ID</td></tr>
<tr><td><code>labels</code></td><td>array of strings</td><td>User labels</td></tr>
</tbody></table>
<ul>
<li><strong>Feedback</strong></li>
</ul>
<table><thead><tr><th>Field Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>feedback_type</code></td><td>string</td><td>Feedback type</td></tr>
<tr><td><code>user_id</code></td><td>string</td><td>User ID</td></tr>
<tr><td><code>item_id</code></td><td>string</td><td>Item ID</td></tr>
<tr><td><code>time_stamp</code></td><td>time</td><td>Feedback time</td></tr>
</tbody></table>
<p>All operations are performed on these three tables (three collections), with the help of indexes to speed things up if necessary. <code>feedback_type</code> specifies the type of feedback: for example, stars, forks, and watches are different types of feedback for GitHub. When inserting feedback, you will encounter that the relevant user or item does not exist in the user and item table. This time <code>auto_insert_user</code> and <code>auto_insert_item</code> can control the insertion behavior, you can choose to insert the user or item automatically, or you can choose to abort the insertion of feedback.</p>
<h2 id="cache-storage"><a class="header" href="#cache-storage">Cache Storage</a></h2>
<p>The cache database stores key-value pairs of both key-string and key-list types. A key consists of two parts: a prefix and a name, which in the Redis implementation are stitched together to become the final key. Since all operations on the cache are point queries, the cache store can easily be scaled to a distributed form.</p>
<h2 id="master-node"><a class="header" href="#master-node">Master Node</a></h2>
<center><img src="img/master.png" height="320"></center>
<p>The master node is responsible for the following tasks.</p>
<ul>
<li><strong>Metadata/members management:</strong> Manages system configuration and cluster membership, cluster node heartbeat timeout is <code>cluster_meta_timeout</code> seconds.</li>
<li><strong>Non-personalized matching:</strong> Collecting the latest items and recent popular items, the update frequency is determined by <code>update_period</code> in minutes.</li>
<li><strong>Cooperative filtering model training:</strong> Train collaborative filtering model every <code>fit_period</code> minutes for worker nodes.</li>
<li><strong>Ranking model training:</strong> The ranking model is trained every <code>fit_period</code> minutes for use by the server nodes.</li>
</ul>
<h2 id="service-node"><a class="header" href="#service-node">Service Node</a></h2>
<center><img src="img/server.png" height="320"></center>
<p>The server node provides two main functions.</p>
<ul>
<li><strong>Exposing RESTful APIs:</strong> The reading and writing of users/items/feedback is done in the form of HTTP requests. The service node receives the HTTP request and then operates on the database and returns the HTTP response.</li>
<li><strong>Performs online recommendation:</strong> At this time, the server node reads the matched items from the cache database, then removes duplicate items and items viewed by users, ranks these matched items after obtaining the items and user labels from the database, and then returns the top <code>n</code> items. The server node needs to continuously check and update the ranking model in the background.</li>
</ul>
<h2 id="worker-node"><a class="header" href="#worker-node">Worker Node</a></h2>
<center><img src="img/worker.png" height="240"></center>
<p>The task of the worker node is a bit simpler - it is to generate a personalized collection of matched items for the user. After connecting to the master node, the worker node constantly checks for updates to the collaborative filtering model. Every once in a while (this time is <code>predict_period</code>) it pulls the information of all worker nodes in the cluster to calculate the range of user IDs it is responsible for, and then generates matched items for the range of users it is responsible for and writes them to the cache database.</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="chapter-2-user-guide"><a class="header" href="#chapter-2-user-guide">Chapter 2: User Guide</a></h1>
<p>This chapter introduces how to use the Gorse recommender system, including writing configuration files, starting the system, and using the exposed HTTP interface.</p>
<h2 id="preparation"><a class="header" href="#preparation">Preparation</a></h2>
<p>Before using Gorse, the following preparations need to be completed.</p>
<ul>
<li>
<p><strong>Database:</strong> Gorse requires two databases, one for data storage and the other for cache storage. The data storage currently supports MySQL and MongoDB, while the cache storage only supports Redis.</p>
</li>
<li>
<p><strong>Hardware:</strong> The Gorse system uses a single machine training and distributed prediction architecture. The master node trains the model and distributes it to server nodes and worker nodes, and multiple server nodes and worker nodes use the trained model for prediction.Gorse recommends the following hardware requirements for the system</p>
<ul>
<li>Processor: Multi-core processors can speed up various tasks by parallel processing.</li>
<li>Memory: server nodes and worker nodes need to meet the model storage, master node memory needs to meet the data and model storage.</li>
</ul>
</li>
</ul>
<h2 id="installation"><a class="header" href="#installation">Installation</a></h2>
<p>Gorse can be installed in the following different ways</p>
<ul>
<li>Download the pre-compiled binary executable from <a href="https://github.com/zhenghaoz/gorse/releases">Release</a>.</li>
<li>Get images from DockerHub</li>
</ul>
<table><thead><tr><th>Image</th><th>Compile Status</th></tr></thead><tbody>
<tr><td>gorse-master</td><td><a href="https://hub.docker.com/repository/docker/zhenghaoz/gorse-master"><img src="https://img.shields.io/docker/cloud/build/zhenghaoz/gorse-master" alt="" /></a></td></tr>
<tr><td>gorse-server</td><td><a href="https://hub.docker.com/repository/docker/zhenghaoz/gorse-server"><img src="https://img.shields.io/docker/cloud/build/zhenghaoz/gorse-server" alt="" /></a></td></tr>
<tr><td>gorse-worker</td><td><a href="https://hub.docker.com/repository/docker/zhenghaoz/gorse-worker"><img src="https://img.shields.io/docker/cloud/build/zhenghaoz/gorse-worker" alt="" /></a></td></tr>
<tr><td>gorse-cli</td><td><a href="https://hub.docker.com/repository/docker/zhenghaoz/gorse-cli"><img src="https://img.shields.io/docker/cloud/build/zhenghaoz/gorse-cli" alt="" /></a></td></tr>
</tbody></table>
<ul>
<li>Compiling from source</li>
</ul>
<p>You need to install the Go compiler first, and then use <code>go get</code> to install</p>
<pre><code>$ go get github.com/zhenghaoz/gorse/...
</code></pre>
<p>The project code is automatically downloaded locally, and the four programs <code>gorse-cli</code>, <code>gorse-leader</code>, <code>gorse-worker</code> and <code>gorse-server</code> are installed in the folder specified by the <code> $GOBIN</code> path.</p>
<h2 id="start"><a class="header" href="#start">Start</a></h2>
<p>First, you need to write a configuration file. The way Gorse works has been described in detail in <a href="chapter_1.html">Chapter 1</a>, refer to <a href="ch02-01-config.html">Configuration</a> in the document to write the recommender system configuration file as <code>config.toml</code>. The section <a href="ch02-02-command.html">Commands</a> in the documentation describes the usage of each command, and the following commands are used to start Gorse's components one by one.</p>
<ul>
<li><strong>Start the master node</strong></li>
</ul>
<p>To start the master node you need to specify the configuration file, and the other nodes get the configuration from the master node.</p>
<pre><code class="language-bash">$ gorse-master -c config.toml
</code></pre>
<ul>
<li><strong>Start the worker node</strong></li>
</ul>
<p>The worker node needs to specify the host and port of the master node, and the number of working threads.</p>
<pre><code class="language-bash">$ gorse-worker --master-host 127.0.0.1 --master-port 8086 -j 4
</code></pre>
<ul>
<li><strong>Start the server node</strong></li>
</ul>
<p>The worker node needs to specify the address and port of the master node, in addition to the address and port of the HTTP interface.</p>
<pre><code class="language-bash">$ gorse-server --master-host 127.0.0.1 --master-port 8086 \
    --host 127.0.0.1 --port 8087
</code></pre>
<h2 id="interact-with-gorse"><a class="header" href="#interact-with-gorse">Interact with Gorse</a></h2>
<ul>
<li><strong>Command line tools</strong></li>
</ul>
<p>Before using the command line tool <code>gorse-cli</code>, you need to save the host and port information of the master node in the <code>~/.gorse/cli.toml</code> directory.</p>
<pre><code class="language-toml">[master]
port = 8086         # master port
host = &quot;127.0.0.1&quot;  # master host
</code></pre>
<p><strong>Step 1: Check the cluster status.</strong> </p>
<pre><code class="language-bash">$ gorse-cli cluster
+--------+-----------------+
|  ROLE  |     ADDRESS     |
+--------+-----------------+
| master | 127.0.0.1:8086  |
| server | 127.0.0.1:14778 |
| worker | 127.0.0.1:1238  |
+--------+-----------------+
</code></pre>
<p>The <code>gorse-cli cluster</code> command shows the nodes in the cluster. The <code>ADDRESS</code> field indicates the address to connect the master node.</p>
<p><strong>Step 2: Import the item data.</strong> </p>
<p>Assuming the recommended items are repositories on GitHub, the raw data file <code>repos.csv</code> is as follows.</p>
<pre><code>01org/cc-oci-runtime,2021-01-25 14:32:01 +0000 UTC,containers|container|docker|kvm|oci|security
02sh/4chanMarkovText,2021-02-08 14:38:55 +0000 UTC,scrapper|data-mining|markov-chain
05bit/peewee-async,2021-01-25 09:35:57 +0000 UTC,peewee|python|asyncio|mysql|postgresql|orm
...
</code></pre>
<p>Each field from left to right is: repository, update time, tag, then the command line to import the data is</p>
<pre><code class="language-bash">$ gorse-cli import items repos.csv
+---------------------------------+--------------------------------+--------------------------------+
|             ITEM ID             |           TIMESTAMP            |             LABEL              |
+---------------------------------+--------------------------------+--------------------------------+
| 01org/cc-oci-runtime            | 2021-01-25 14:32:01 +0000      | [containers container          |
|                                 | +0000                          | docker kvm oci security        |
|                                 |                                | virtual-machine                |
|                                 |                                | virtualization]                |
| 02sh/4chanMarkovText            | 2021-02-08 14:38:55 +0000      | [scrapper data-mining          |
|                                 | +0000                          | markov-chain]                  |
+---------------------------------+--------------------------------+--------------------------------+
Import items to database? [Y/n] 
</code></pre>
<p>The command line tool recognizes the data and confirms that it can be imported into the database.</p>
<p><strong>Step 3: Import the interactive data.</strong> </p>
<p>Assuming that the interaction data is the user's likes to the repository, the original data file <code>stars.csv</code> is as follows.</p>
<pre><code>0xAX,0xAX/erlang-bookmarks,2013-08-31 19:48:01 +0000 UTC
0xAX,abo-abo/hydra,2020-12-27 17:35:57 +0000 UTC
0xAX,alebcay/awesome-shell,2015-06-16 17:17:17 +0000 UTC
0xAX,angrave/SystemProgramming,2015-02-22 16:47:33 +0000 UTC
0xAX,binhnguyennus/awesome-scalability,2018-01-27 18:00:00 +0000 UTC
...
</code></pre>
<p>Each field from left to right is: user, repository, and time of likes. Then the command line to import the data is.</p>
<pre><code class="language-bash">$ gorse-cli import feedback
+------+---------+-----------------------------------+--------------------------------+
| TYPE | USER ID |              ITEM ID              |           TIMESTAMP            |
+------+---------+-----------------------------------+--------------------------------+
|      | 0xAX    | 0xAX/erlang-bookmarks             | 2013-08-31 19:48:01 +0000      |
|      |         |                                   | +0000                          |
|      | 0xAX    | abo-abo/hydra                     | 2020-12-27 17:35:57 +0000      |
|      |         |                                   | +0000                          |
|      | 0xAX    | alebcay/awesome-shell             | 2015-06-16 17:17:17 +0000      |
|      |         |                                   | +0000                          |
|      | 0xAX    | angrave/SystemProgramming         | 2015-02-22 16:47:33 +0000      |
|      |         |                                   | +0000                          |
|      | 0xAX    | binhnguyennus/awesome-scalability | 2018-01-27 18:00:00 +0000      |
|      |         |                                   | +0000                          |
|      | 0xAX    | bitwalker/conform                 | 2015-06-10 13:32:03 +0000      |
|      |         |                                   | +0000                          |
+------+---------+-----------------------------------+--------------------------------+
Import feedback into database (type = &quot;&quot;, auto_insert_user = true, auto_insert_item = false) [Y/n] 
</code></pre>
<p>The data file is also successfully identified, and you can see that the interaction data type <code>TYPE</code> column is empty, because the command does not set the interaction type. Note that the data type set when importing data needs to correspond to the matching feedback type or ranking feedback type in the configuration file, otherwise the feedback data will not be loaded.</p>
<p><strong>Step 4: Generate recommendations.</strong> </p>
<p>If everything goes well, Gorse will load the data and train the model after some time.</p>
<pre><code class="language-bash">time=&quot;2021-03-03T14:00:27+08:00&quot; level=info msg=&quot;master: load data from database&quot;
time=&quot;2021-03-03T14:00:28+08:00&quot; level=info msg=&quot;master: data loaded (#user = 982, #item = 45247, #feedback = 5922)&quot;
time=&quot;2021-03-03T14:00:28+08:00&quot; level=info msg=&quot;master: collect latest items&quot;
time=&quot;2021-03-03T14:00:28+08:00&quot; level=info msg=&quot;master: completed collecting latest items&quot;
time=&quot;2021-03-03T14:30:28+08:00&quot; level=info msg=&quot;fit FM(r): train set size (positive) = 3432, test set size = 1716&quot;
...
</code></pre>
<ul>
<li><strong>RESTful APIs</strong></li>
</ul>
<p>The server node opens the <a href="ch02-03-api.html">RESTful APIs</a> to facilitate interaction with Gorse. The server node provides the RESTful APIs with specific documentation under the <code>apidocs</code> path. If the address of the service node HTTP service is <code>127.0.0.1:8087</code>, then the URL of the documentation is <a href="http://127.0.0.1:8087/apidocs"><code>http://127.0.0.1:8087/apidocs</code></a>.</p>
<p>! <a href="img/swagger.png"></a></p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="configuration"><a class="header" href="#configuration">Configuration</a></h1>
<h2 id="database-configuration"><a class="header" href="#database-configuration">Database Configuration</a></h2>
<p>The database configuration is located under <code>[database]</code>.</p>
<table><thead><tr><th>Key</th><th>Type</th><th>Description</th><th>Default</th></tr></thead><tbody>
<tr><td><code>cache_store</code></td><td>string</td><td>Database for data (supports MySQL/MongoDB)</td><td>redis://127.0.0.1:6379</td></tr>
<tr><td><code>data_store</code></td><td>string</td><td>Database for cache (supports Redis)</td><td>mysql://root@tcp(127.0.0.1:3306)/gorse</td></tr>
<tr><td><code>auto_insert_user</code></td><td>bool</td><td>Automatically insert new users when inserting new feedback</td><td>true</td></tr>
<tr><td><code>auto_insert_item</code></td><td>bool</td><td>Automatically insert new items when inserting new feedback</td><td>true</td></tr>
</tbody></table>
<p>The DSN (Database Source Name) format of the <code>data_store</code> and <code>cache_store</code> is as follows.</p>
<ul>
<li>Redis: <code>redis://hostname:port</code></li>
<li>MySQL: <code>mysql://[username[:password]@][protocol[(hostname:port)]]/database[?config1=value1&amp;...configN=valueN]</code></li>
<li>MongoDB: <code>mongodb://[username:password@]hostname1[:port1][,... hostnameN[:portN]]][/[database][?options]]</code></li>
</ul>
<h2 id="similar-item-configuration"><a class="header" href="#similar-item-configuration">Similar Item Configuration</a></h2>
<p>Similar item configurations are located under <code>[similar]</code>.</p>
<table><thead><tr><th>Key</th><th>Type</th><th>Description</th><th>Default</th></tr></thead><tbody>
<tr><td><code>n_similar</code></td><td>int</td><td>Number of similar items to cache, 0 means disabled</td><td>100</td></tr>
<tr><td><code>update_period</code></td><td>int</td><td>Time interval (in minutes) to update similar items</td><td>60</td></tr>
</tbody></table>
<h2 id="latest-item-configuration"><a class="header" href="#latest-item-configuration">Latest Item Configuration</a></h2>
<p>The latest item configuration is located under <code>[latest]</code>.</p>
<table><thead><tr><th>Key</th><th>Type</th><th>Description</th><th>Default</th></tr></thead><tbody>
<tr><td><code>n_latest</code></td><td>int</td><td>Number of latest items to cache, 0 means disabled</td><td>100</td></tr>
<tr><td><code>update_period</code></td><td>int</td><td>Time interval to update the latest items (in minutes)</td><td>10</td></tr>
</tbody></table>
<h2 id="popular-item-configuration"><a class="header" href="#popular-item-configuration">Popular Item Configuration</a></h2>
<p>The popular item configuration is located under <code>[popular]</code>.</p>
<table><thead><tr><th>Key</th><th>Type</th><th>Description</th><th>Default</th></tr></thead><tbody>
<tr><td><code>n_popular</code></td><td>int</td><td>Number of popular items to cache, 0 means disabled</td><td>100</td></tr>
<tr><td><code>update_period</code></td><td>int</td><td>Time interval to update popular items (in minutes)</td><td>1440</td></tr>
<tr><td><code>time_window</code></td><td>int</td><td>Popular items within the previous N days</td><td>365</td></tr>
</tbody></table>
<h2 id="collaborative-filtering-configuration"><a class="header" href="#collaborative-filtering-configuration">Collaborative Filtering Configuration</a></h2>
<p>The collaborative filtering configuration is located under <code>[cf]</code>.</p>
<table><thead><tr><th>Key</th><th>Type</th><th>Description</th><th>Default</th></tr></thead><tbody>
<tr><td><code>n_cf</code></td><td>int</td><td>Number of collaborative filtering matched items, 0 means disabled</td><td>800</td></tr>
<tr><td><code>cf_model</code></td><td>string</td><td>Collaborative filtering model (select from <code>als</code>, <code>bpr</code> and <code>ccd</code>)</td><td>als</td></tr>
<tr><td><code>fit_period</code></td><td>int</td><td>Interval (in minutes) to update the collaborative filtering model</td><td>1440</td></tr>
<tr><td><code>predict_period</code></td><td>int</td><td>Update collaborative filtering matched items interval (in minutes)</td><td>60</td></tr>
<tr><td><code>feedback_types</code></td><td>int</td><td>Feedback types used by collaborative filtering model</td><td>[&quot;&quot;]</td></tr>
<tr><td><code>fit_jobs</code></td><td>int</td><td>Number of model training threads</td><td>1</td></tr>
<tr><td><code>verbose</code></td><td>int</td><td>Iteration interval for reporting costs and recommendation accuracy</td><td>10</td></tr>
<tr><td><code>n_candidates</code></td><td>int</td><td>Number of candidates used to estimate the recommendation accuracy</td><td>100</td></tr>
<tr><td><code>top_k</code></td><td>int</td><td>Length of the recommendation list to estimate the recommendation accuracy, i.e. N in NDCG@N</td><td>10</td></tr>
<tr><td><code>n_test_users</code></td><td>int</td><td>Number of users in the test set (0 means use all users to test)</td><td>0</td></tr>
</tbody></table>
<p>The configurations related to the model hyper-parameters are as follows. The default values of hyper-parameters depend on the corresponding model settings.</p>
<table><thead><tr><th>Key</th><th>Type</th><th>Description</th><th>Corresponding model</th></tr></thead><tbody>
<tr><td><code>lr</code></td><td>float</td><td>Learning rate</td><td>BPR</td></tr>
<tr><td><code>reg</code></td><td>float</td><td>Regularization coefficient</td><td>BPR/ALS/CCD</td></tr>
<tr><td><code>n_epochs</code></td><td>int</td><td>Number of iterations</td><td>BPR/ALS/CCD</td></tr>
<tr><td><code>n_factors</code></td><td>int</td><td>Number of latent factors</td><td>BPR/ALS/CCD</td></tr>
<tr><td><code>init_mean</code></td><td>float</td><td>Mean of gaussian random initializer</td><td>BPR/ALS/CCD</td></tr>
<tr><td><code>init_std</code></td><td>float</td><td>Standard deviation of gaussian random initializer</td><td>BPR/ALS/CCD</td></tr>
<tr><td><code>alpha</code></td><td>float</td><td>Weight for negative samples</td><td>ALS/CCD</td></tr>
</tbody></table>
<h2 id="ranking-configuration"><a class="header" href="#ranking-configuration">Ranking Configuration</a></h2>
<p>The ranking configuration is located under <code>[rank]</code>.</p>
<table><thead><tr><th>Key</th><th>Type</th><th>Description</th><th>Default</th></tr></thead><tbody>
<tr><td><code>task</code></td><td>int</td><td>Task type (<code>r</code> for regression, <code>c</code> for classification)</td><td><code>r</code></td></tr>
<tr><td><code>feedback_types</code></td><td>int</td><td>Types of feedback used for ranking</td><td>[&quot;&quot;]</td></tr>
<tr><td><code>fit_period</code></td><td>int</td><td>Time interval to update the ranking model (in minutes)</td><td>1440</td></tr>
<tr><td><code>fit_jobs</code></td><td>int</td><td>Number of threads for model training</td><td>1</td></tr>
<tr><td><code>verbose</code></td><td>int</td><td>Iteration interval for reporting costs and prediction accuracies</td><td>10</td></tr>
</tbody></table>
<p>The configurations related to the model hyper-parameters are as follows.</p>
<table><thead><tr><th>Key</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>lr</code></td><td>float</td><td>Learning rate</td></tr>
<tr><td><code>reg</code></td><td>float</td><td>Regularization coefficient</td></tr>
<tr><td><code>n_epochs</code></td><td>int</td><td>Number of iterations</td></tr>
<tr><td><code>n_factors</code></td><td>int</td><td>Number of latent factors</td></tr>
<tr><td><code>init_mean</code></td><td>float</td><td>Mean of gaussian random initializer</td></tr>
<tr><td><code>init_std</code></td><td>float</td><td>Standard deviation of gaussian random initializer</td></tr>
</tbody></table>
<h2 id="master-configuration"><a class="header" href="#master-configuration">Master Configuration</a></h2>
<p>The master configuration is located under <code>[cf]</code>.</p>
<table><thead><tr><th>Key</th><th>Type</th><th>Description</th><th>Default</th></tr></thead><tbody>
<tr><td><code>host</code></td><td>string</td><td>Master node listening host</td><td>127.0.0.1</td></tr>
<tr><td><code>port</code></td><td>int</td><td>Master node listening port</td><td>8086</td></tr>
<tr><td><code>jobs</code></td><td>int</td><td>Number of working threads</td><td>1</td></tr>
<tr><td><code>cluster_meta_timeout</code></td><td>int</td><td>Metadata timeout</td><td>60</td></tr>
</tbody></table>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="commands"><a class="header" href="#commands">Commands</a></h1>
<h2 id="master-node-commands"><a class="header" href="#master-node-commands">Master Node Commands</a></h2>
<pre><code>$ gorse-master -h
The master node of gorse recommender system.

Usage:
  gorse-master [flags]

Flags:
  -c, --config string   configuration file path (default &quot;/etc/gorse.toml&quot;)
  -h, --help            help for gorse-master
      --host string     host of master node (default &quot;127.0.0.1&quot;)
      --port int        port of master node (default 8086)
  -v, --version         gorse version
</code></pre>
<p>The master node needs to specify the configuration file path, in addition, you can use the command line to set the listening host and port, the host and port specified in the command line will override the host and port settings in the configuration file.</p>
<h2 id="service-node-commands"><a class="header" href="#service-node-commands">Service Node Commands</a></h2>
<pre><code>$ gorse-server -h
The server node of gorse recommender system.

Usage:
  gorse-server [flags]

Flags:
  -h, --help                  help for gorse-server
      --host string           host of server node (default &quot;127.0.0.1&quot;)
      --master-host string   host of master node (default &quot;127.0.0.1&quot;)
      --master-port int       port of master node (default 8086)
      --port int              port of server node (default 8087)
  -v, --version               gorse version
</code></pre>
<p>The server node needs to specify the host and port of the master node, as well as the host and port to open the HTTP service.</p>
<h2 id="work-node-commands"><a class="header" href="#work-node-commands">Work Node Commands</a></h2>
<pre><code>$ gorse-worker -h
The worker node of gorse recommender system.

Usage:
  gorse-worker [flags]

Flags:
  -h, --help                 help for gorse-worker
  -j, --jobs int             number of working jobs. (default 4)
      --master-host string   host of master node (default &quot;127.0.0.1&quot;)
      --master-port int      port of master node (default 8086)
</code></pre>
<p>The worker node needs to specify the host and port of the master node, and the number of working threads.</p>
<h2 id="cli-tools"><a class="header" href="#cli-tools">CLI Tools</a></h2>
<pre><code>$ gorse-cli -h
CLI for gorse recommender system.

Usage:
  gorse-cli [command]

Available Commands:
  cluster     cluster information
  export      export data
  help        Help about any command
  import      import data
  status      status of recommender system
  test        test recommendation model
  tune        tune recommendation model by random search
  version     gorse version

Flags:
  -h, --help   help for gorse-cli

Use &quot;gorse-cli [command] --help&quot; for more information about a command.
</code></pre>
<p>The CLI tools can list cluster members, view system status, import/export data, test model, and search for model optimal hyper-parameters.</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="restful-apis"><a class="header" href="#restful-apis">RESTful APIs</a></h1>
<p>The server node provides RESTful APIs with documents under the <code>apidocs</code> path. If the address of the server's RESTful API service is <code>127.0.0.1:8087</code>, then the URL of the document is <a href="http://127.0.0.1:8087/apidocs"><code>http://127.0.0.1:8087/apidocs</code></a>.</p>
<p><img src="img/swagger.png" alt="" /></p>
<h2 id="data-interfaces"><a class="header" href="#data-interfaces">Data Interfaces</a></h2>
<p>There are operations on user/item/feedback data.</p>
<table><thead><tr><th>Method</th><th>URL</th><th>Description</th></tr></thead><tbody>
<tr><td>POST</td><td>/user</td><td>Insert a user</td></tr>
<tr><td>DELETE</td><td>/user</td><td>Delete a user and all associated feedback</td></tr>
<tr><td>GET</td><td>/user/{user-id}</td><td>Get a user</td></tr>
<tr><td>GET</td><td>/users</td><td>Get all users</td></tr>
<tr><td>POST</td><td>/item</td><td>Insert an item</td></tr>
<tr><td>DELETE</td><td>/item</td><td>Delete an item</td></tr>
<tr><td>GET</td><td>/item/{item-id}</td><td>Get an item and delete all related feedback</td></tr>
<tr><td>GET</td><td>/items</td><td>Get all items</td></tr>
<tr><td>POST</td><td>/feedback</td><td>Batch insert feedbacks</td></tr>
<tr><td>GET</td><td>/feedback</td><td>Get all feedbacks</td></tr>
<tr><td>GET</td><td>/user/{user-id}/feedback/{feedback-type}</td><td>Get user feedback</td></tr>
<tr><td>GET</td><td>/item/{item-id}/feedback/{feedback-type}</td><td>Get item feedback</td></tr>
</tbody></table>
<h2 id="caching-apis"><a class="header" href="#caching-apis">Caching APIs</a></h2>
<p>Get matched items.</p>
<table><thead><tr><th>Method</th><th>URL</th><th>Description</th></tr></thead><tbody>
<tr><td>GET</td><td>/latest</td><td>Get the latest items</td></tr>
<tr><td>GET</td><td>/popular</td><td>Get recent popular items</td></tr>
<tr><td>GET</td><td>/neighbors/{item-id}</td><td>Get similar items</td></tr>
<tr><td>GET</td><td>/cf/{user-id}</td><td>Get collaborative filtering recommended items</td></tr>
</tbody></table>
<h2 id="recommendation-apis"><a class="header" href="#recommendation-apis">Recommendation APIs</a></h2>
<p>Online recommendations are generated by the server node in real-time.</p>
<table><thead><tr><th>Method</th><th>URL</th><th>Description</th></tr></thead><tbody>
<tr><td>GET</td><td>/recommend/{user-id}</td><td>Online recommendations</td></tr>
</tbody></table>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        

                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                

                
            </nav>

        </div>

        

        

        

        
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        

        

        
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        
        
        <script type="text/javascript">
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>
        
        

    </body>
</html>
